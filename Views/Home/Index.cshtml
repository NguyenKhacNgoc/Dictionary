@{
    ViewBag.Title = "HAPNDictionary";
}
@model  List<Dictionary.Models.tblLanguage>

<div class="dictionary-container">
    <h1>HAPN Dictionary</h1>
    <div class="search-box">
        <div class="p_lang_wrap">
            <div class="p_select_lang_wrap">
                <label>Chọn ngôn ngữ nhập</label>
                <select class="p_select_lang">
                    @foreach (var item in Model)
                    {
                        <option value="@item.sLanguage">@item.sLanguage</option>
                    }
                </select>
            </div>
            <div class="p_select_lang_trans_wrap">
                <label>Chọn ngôn ngữ dịch</label>
                <select class="p_select_lang_trans">
                    @foreach (var item in Model)
                    {
                        <option value="@item.sLanguage">@item.sLanguage</option>
                    }
                </select>
            </div>
        </div>
        <div class="p_search_wrap">
            <input type="text" id="search-input" placeholder="Nhấp vào đây...">
            <button id="search-button">Tra cứu</button>
        </div>
        <div id="list_search"></div>
    </div>
    <div id="result">
        <!-- Kết quả tra cứu sẽ hiển thị ở đây -->
    </div>
</div>
<script>
    document.getElementById('search-input').addEventListener('input', function (e) {
        search_word();

    });

    document.addEventListener('click', function (event) {
        var listSearch = document.getElementById('list_search');
        var pSearchWrap = document.querySelector('.search-box');
        var searchInput = document.getElementById('search-input');
        var wordItem = event.target.closest('.word_item');

        if (wordItem !== null) {
            if (listSearch.classList.contains('p_active')) {
                listSearch.classList.remove('p_active');
                search_word_detail(wordItem);
            }
        }

        

        if (pSearchWrap !== null && !pSearchWrap.contains(event.target)) {
            if (listSearch.classList.contains('p_active')) {
                listSearch.classList.remove('p_active');
                console.log('remove(p_active)');
            }
           
        }

        if (event.target == searchInput && searchInput.value !== '') {
            listSearch.classList.add('p_active');
        }

      

    });


    document.querySelector('.p_select_lang, .p_select_lang_trans').addEventListener('change', function () {
        search_word()
    });



    function search_word() {
        var searchInputValue = document.getElementById('search-input').value;
        var selectedLang = document.querySelector('.p_select_lang option:checked').value;
        var selectedLangTrans = document.querySelector('.p_select_lang_trans option:checked').value;
        var listSearch = document.getElementById('list_search');

        if (searchInputValue != '') {
            listSearch.classList.add('p_active');
            var xhr = new XMLHttpRequest();
            var url = '/Home/Search_result';

            xhr.open('GET', url + '?text=' + encodeURIComponent(searchInputValue) + '&lang=' + encodeURIComponent(selectedLang) + '&lang_tran=' + encodeURIComponent(selectedLangTrans), true);

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    document.getElementById('list_search').innerHTML = xhr.responseText;
                }
            };

            xhr.send();
        } else {
           
            var pDropDownElement = listSearch.querySelector('.p_drop_down');

            if (pDropDownElement !== null) {
                // Tạo chuỗi HTML mới cho phần tử <a>
                var newAnchorHTML = '<a href="javascript:void(0)" class="p_empty  p_flex_start">Bạn đan bỏ trống</a>';

                // Thay thế nội dung HTML của phần tử .p_drop_down
                pDropDownElement.innerHTML = newAnchorHTML;
                listSearch.classList.remove('p_active');
            } else {

                console.log('Không có phần tử con trong #list_search');
            }
        }
    }


    function search_word_detail(target) {
        var searchInputValue = target.querySelector('.word_text').textContent;
        var selectedLang = document.querySelector('.p_select_lang option:checked').value;
        var selectedLangTrans = document.querySelector('.p_select_lang_trans option:checked').value;
        var result = document.getElementById('result');

        if (searchInputValue != '') {
            var xhr = new XMLHttpRequest();
            var url = '/Home/Search_result_detail';

            xhr.open('GET', url + '?text=' + encodeURIComponent(searchInputValue) + '&lang=' + encodeURIComponent(selectedLang) + '&lang_tran=' + encodeURIComponent(selectedLangTrans), true);

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    document.getElementById('result').innerHTML = xhr.responseText;
                }
            };

            xhr.send();
        }
    }

</script>